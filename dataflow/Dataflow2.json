{
	"name": "Dataflow2",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ADLS_meridata_JSON",
						"type": "DatasetReference"
					},
					"name": "meridata"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSynapseAnalyticsTable2",
						"type": "DatasetReference"
					},
					"name": "outputMeriData"
				}
			],
			"transformations": [
				{
					"name": "select1"
				},
				{
					"name": "flatten1"
				},
				{
					"name": "derivedColumn1"
				},
				{
					"name": "derivedColumn2"
				},
				{
					"name": "select2"
				}
			],
			"scriptLines": [
				"source(output(",
				"          type as string,",
				"          dataUpdatedTime as string,",
				"          features as (siteNumber as integer, type as string, geometry as (type as string, coordinates as double[]), properties as (siteNumber as integer, siteName as string, siteType as string, lastUpdate as string, seaState as string, trend as string, windWaveDir as integer, confidence as string, heelAngle as double, lightStatus as string, temperature as integer))[]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'singleDocument') ~> meridata",
				"meridata select(mapColumn(",
				"          features",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 foldDown(unroll(features),",
				"     mapColumn(",
				"          type = features.type,",
				"          coordinates = features.geometry.coordinates,",
				"          siteNumber = features.properties.siteNumber,",
				"          siteName = features.properties.siteName,",
				"          siteType = features.properties.siteType,",
				"          lastUpdate = features.properties.lastUpdate,",
				"          seaState = features.properties.seaState,",
				"          trend = features.properties.trend,",
				"          windWaveDir = features.properties.windWaveDir,",
				"          confidence = features.properties.confidence,",
				"          heelAngle = features.properties.heelAngle,",
				"          lightStatus = features.properties.lightStatus,",
				"          temperature = features.properties.temperature",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"flatten1 derive(latitude = coordinates[1]) ~> derivedColumn1",
				"derivedColumn1 derive(longitude = coordinates[2]) ~> derivedColumn2",
				"derivedColumn2 select(mapColumn(",
				"          type,",
				"          coordinates,",
				"          siteNumber,",
				"          siteName,",
				"          siteType,",
				"          lastUpdate,",
				"          seaState,",
				"          trend,",
				"          windWaveDir,",
				"          confidence,",
				"          heelAngle,",
				"          lightStatus,",
				"          temperature,",
				"          latitude,",
				"          longitude",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"select2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError') ~> outputMeriData"
			]
		}
	}
}